BEGIN;

CREATE TYPE "sex" AS ENUM (
    'f',
    'm'
    );

CREATE TYPE "goal" AS ENUM (
    'fun',
    'profit',
    '50_50'
    );

CREATE TYPE "status" AS ENUM (
    'active',
    'inactive'
    );

CREATE TABLE "space" (
                         "id" integer PRIMARY KEY,
                         "name" text UNIQUE NOT NULL
);

CREATE TABLE "user_space" (
                              "user_id" integer,
                              "space_id" integer,
                              PRIMARY KEY ("user_id", "space_id")
);

CREATE TABLE "user" (
                        "id" integer UNIQUE NOT NULL,
                        "username" text UNIQUE NOT NULL,
                        "full_name" text,
                        "birthday" date,
                        "gender" text,
                        "city" varchar,
                        "socials" varchar,
                        "position" varchar,
                        "sex" sex,
                        "photo_url" varchar,
                        "interests" text,
                        "goal" goal
);

CREATE TABLE "holidays_status" (
                                   "id" integer PRIMARY KEY,
                                   "status" status,
                                   "till_date" date NOT NULL
);

CREATE TABLE "event" (
                         "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                         "date" date,
                         "name" varchar,
                         "description" varchar
);

CREATE TABLE "event_members" (
                                 "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                                 "event_id" integer,
                                 "user_id" integer
);

CREATE TABLE "reviews" (
                           "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                           "event_id" integer,
                           "who_id" integer,
                           "about_whom_id" integer,
                           "grade" integer NOT NULL
);

CREATE TABLE "blocks" (
                          "id" integer,
                          "user_id" integer NOT NULL
);

ALTER TABLE "user_space" ADD FOREIGN KEY ("user_id") REFERENCES "user" ("id");

ALTER TABLE "user_space" ADD FOREIGN KEY ("space_id") REFERENCES "space" ("id");

ALTER TABLE "holidays_status" ADD FOREIGN KEY ("id") REFERENCES "user" ("id");

ALTER TABLE "event_members" ADD FOREIGN KEY ("event_id") REFERENCES "event" ("id");

ALTER TABLE "event_members" ADD FOREIGN KEY ("user_id") REFERENCES "user" ("id");

ALTER TABLE "reviews" ADD FOREIGN KEY ("event_id") REFERENCES "event" ("id");

ALTER TABLE "reviews" ADD FOREIGN KEY ("who_id") REFERENCES "user" ("id");

ALTER TABLE "reviews" ADD FOREIGN KEY ("about_whom_id") REFERENCES "user" ("id");

ALTER TABLE "blocks" ADD FOREIGN KEY ("id") REFERENCES "user" ("id");

COMMIT;

BEGIN;
-- Insert data into 'space' table
INSERT INTO "space" ("id", "name")
VALUES
    (1, 'Space A'),
    (2, 'Space B'),
    (3, 'Space C');

-- Insert data into 'user' table
INSERT INTO "user" ("id", "username", "full_name", "birthday", "gender", "city", "socials", "position", "sex", "photo_url", "interests", "goal")
VALUES
    (1, 'user1', 'User One', '1990-01-01', 'M', 'City A', '@user1', 'Developer', 'm', 'http://photo.url/user1', 'coding, music', 'fun'),
    (2, 'user2', 'User Two', '1992-02-02', 'F', 'City B', '@user2', 'Designer', 'f', 'http://photo.url/user2', 'design, art', 'profit'),
    (3, 'user3', 'User Three', '1993-03-03', 'M', 'City C', '@user3', 'Manager', 'm', 'http://photo.url/user3', 'management, strategy', '50_50');

-- Insert data into 'user_space' table
INSERT INTO "user_space" ("user_id", "space_id")
VALUES
    (1, 1),
    (1, 2),
    (2, 1),
    (3, 3);

-- Insert data into 'holidays_status' table
INSERT INTO "holidays_status" ("id", "status", "till_date")
VALUES
    (1, 'active', '2024-12-31'),
    (2, 'inactive', '2023-06-30');

-- Insert data into 'event' table
INSERT INTO "event" ("date", "name", "description")
VALUES
    ('2024-01-01', 'New Year Party', 'Celebrate the New Year!'),
    ('2024-07-04', 'Independence Day', 'Celebration of Independence Day.');

-- Insert data into 'event_members' table
INSERT INTO "event_members" ("event_id", "user_id")
VALUES
    (1, 1),
    (1, 2),
    (2, 1),
    (2, 3);

-- Insert data into 'reviews' table
INSERT INTO "reviews" ("event_id", "who_id", "about_whom_id", "grade")
VALUES
    (1, 1, 2, 5),
    (1, 2, 1, 4),
    (2, 1, 3, 3);

-- Insert data into 'blocks' table
INSERT INTO "blocks" ("id", "user_id")
VALUES
    (1, 2),
    (2, 3);

COMMIT;